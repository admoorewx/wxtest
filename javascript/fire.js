//------------------ Link Buttons -------------------------
nifc_list = [
  "https://www.nifc.gov/",
  "https://www.nifc.gov/fire-information/nfn",
  "https://www.nifc.gov/fire-information/statistics",
  "https://inciweb.nwcg.gov/",
  "https://www.nifc.gov/nicc/sitreprt.pdf",
  "https://wildfiretoday.com/",
  "https://m.wfas.net/",
  "https://www.predictiveservices.nifc.gov/NMAC%20Weather%20Outlook.mp4",
  "https://www.predictiveservices.nifc.gov/outlooks/NA_Outlook.pdf"
]

gacc_list = [
  "https://gacc.nifc.gov/",
  "https://gacc.nifc.gov/nwcc/predict/fire_fuel.aspx",
  "https://gacc.nifc.gov/oncc/",
  "https://gacc.nifc.gov/oscc/",
  "https://gacc.nifc.gov/gbcc/",
  "https://gacc.nifc.gov/nrcc/",
  "https://gacc.nifc.gov/rmcc/",
  "https://gacc.nifc.gov/swcc/",
  "https://gacc.nifc.gov/sacc/",
  "https://gacc.nifc.gov/eacc/"
]

cal_resource_list = [
  "https://cw3e.ucsd.edu/precipitation-observations/",
  "https://www.weather.gov/lox/fwmV3",
  "https://cansac.dri.edu/cansac_output.php?model=WRF",
  "https://gacc.nifc.gov/oscc/predictive/weather/index.htm?m=no",
  "https://gacc.nifc.gov/oscc/predictive/weather/myfiles/Webcast.mp4"
]

misc_resource_list = [
  "https://fsapps.nwcg.gov/afm/index.php",
  "https://www.weather.gov/spot/monitor/",
  "https://gacc.nifc.gov/gbcc/predictive/cfs/#/",
  "https://maps.cocorahs.org/",
  "https://water.weather.gov/precip/",
  "https://www.predictiveservices.nifc.gov/fuels_fire-danger/national_fire_danger.html",
  "https://www.pivotalweather.com/maps.php?ds=mrms&p=mrms_qpe_024h_p&r=conus",
  "https://firms.modaps.eosdis.nasa.gov/usfs/map/#d:24hrs;l:noaa20-viirs,viirs,modis_a,modis_t,active-usa,country-outline;@-93.1,38.5,5z",
  "https://fireweather.cira.colostate.edu/index8.php?usr=wfdss_gusr&page=rmc",
  "http://www.mesonet.org/index.php/okfire/map/energy_release_component1/current_maps",
  "https://secondary.mesonet.ksu.edu/fire/nfdrs/",
  "https://fire.airnow.gov/",
  "https://cimss.ssec.wisc.edu/volcat-wildfires/event-dashboard/",
  "https://wrcc.dri.edu/Monitoring/spi_products.php",
  "https://vegdri.unl.edu/Home.aspx",
  "https://www.hdwindex.org/",
  "https://data-nifc.opendata.arcgis.com/datasets/nifc::wfigs-current-wildland-fire-locations/about"
]

state_list = [
  "http://www.forestry.alabama.gov/",
  "http://forestry.alaska.gov/fire/current.htm",
  "http://www.azsf.az.gov/",
  "http://www.arkfireinfo.org/index.php?do:showWildFires",
  "http://www.fire.ca.gov/incidents",
  "http://www.coemergency.com/p/fire-bans-danger.html",
  "http://www.ct.gov/dep/cwp/view.asp?a=2697&q=322780&depNav_GID=1631&depNav=|",
  "http://dda.delaware.gov/forestry/protec.shtml",
  "http://www.fl-dof.com/wildfire/index.html",
  "http://weather.gfc.state.ga.us/",
  "http://dlnr.hawaii.gov/dofaw/",
  "http://www.idahofireinfo.com/",
  "https://www.illinois.gov/health-safety/Pages/EnvironmentAndWeather.aspx",
  "http://www.iowadnr.gov/Environment/Forestry/FirePrevention.aspx",
  "http://www.in.gov/dnr/forestry/2852.htm",
  "http://www.kansasforests.org/programs/fire/fireprogram.shtml",
  "http://forestry.ky.gov/wildlandfiremanagement/Pages/default.aspx",
  "http://www.ldaf.state.la.us/forestry/",
  "http://www.maine.gov/doc/mfs/firedanger/fire.shtml",
  "http://dnr.maryland.gov/forests/Pages/wfm.aspx",
  "http://www.mass.gov/eea/state-parks-beaches/sustainable-forest-management/",
  "https://www.michigan.gov/dnr/managing-resources/forestry/fire",
  "http://www.dnr.state.mn.us/forestry/fire/index.html",
  "http://www.mfc.ms.gov/",
  "http://mdc4.mdc.mo.gov/applications/FireReporting/Report.aspx",
  "http://dnrc.mt.gov/divisions/forestry",
  "http://nfs.unl.edu/",
  "http://forestry.nv.gov/fire-program/",
  "http://www.nhdfl.org/fire-control-and-law-enforcement/",
  "http://www.state.nj.us/dep/parksandforests/fire/aboutus.html",
  "http://www.nmfireinfo.com/",
  "http://www.dec.ny.gov/lands/4975.html",
  "http://ncforestservice.gov/index.htm",
  "http://www.ndsu.edu/ndfs/",
  "http://www.dnr.state.oh.us/forestry/Home/fire/default/tabid/5120/Default.aspx",
  "http://www.forestry.ok.gov/fire",
  "http://www.oregon.gov/odf/Fire/Pages/default.aspx",
  "http://www.dcnr.state.pa.us/index.aspx",
  "http://www.dem.ri.gov/",
  "http://www.state.sc.us/forest/fire.htm",
  "http://wildlandfire.sd.gov/",
  "http://www.tn.gov/agriculture/topic/ag-eac-forestry",
  "http://www.tamu.edu/ticc/predictiveservices.htm",
  "http://www.ffsl.utah.gov/index.php/fire",
  "http://www.vtfpr.org/protection/for_protect_firecont.cfm",
  "http://www.dof.virginia.gov/fire/index.htm",
  "http://www.dnr.wa.gov/programs-and-services/wildfire-resources",
  "http://www.wvforestry.com/fire_prev.cfm?menucall=fire",
  "http://dnr.wi.gov/topic/ForestFire/",
  "http://wsfd.wyo.gov/"
]

reference_material = [
  "https://www.weather.gov/pimar/FireZones",
  "http://www.nifc.gov/policies/pol_ref_redbook.html",
  "https://www.nifc.gov/nicc/logistics/references/Fire%20Imaging%20Technologies%20Users%20Guide.pdf",
  "https://famit.nwcg.gov/applications/WIMS/PocketCards/PocketCards",
  "https://gacc.nifc.gov/oncc/docs/40-Standard%20Fire%20Behavior%20Fuel%20Models.pdf",
  "https://gacc.nifc.gov/oncc/docs/13_Aids%20to%20Determining%20Fuel%20Models.pdf",
  "https://gacc.nifc.gov/oncc/docs/Fire%20Behavior%20Nomograms%20NEW.pdf",
  "https://www.fs.fed.us/pnw/pubs/pnw_gtr854.pdf",
  "https://www.fs.fed.us/pnw/pubs/pnw_gtr891.pdf",
  "https://www.usfa.fema.gov/downloads/pdf/publications/fa-266.pdf"
]

function openallLinks(link_list){
  link_list.forEach((i) => {
    window.open(i,"_blank");
  });
} // end function

function RH(temp,dewp){
  // Note that this uses the August-Roche-Magnus approximation.
  // Formula comes from the online-calculator on https://bmcnoldy.rsmas.miami.edu/Humidity.html
  // T and Td must be in Celsius
  let num = Math.exp( (17.625*dewp) / (243.04+dewp) );
  let denom = Math.exp( (17.625*temp) / (243.05+temp) );
  let relh = 100.0 * (num/denom);
  return Math.round(relh);
}

function C2F(tempC) {
  if (tempC == null){
    return "--"
  } // end if
  else {
    tempF = (1.8 * tempC) + 32.0
    return Math.round(tempF);
  } // end else
} // end C2F

///////////////////////////////////////////////////////////////////////////////
function relhColor(relh){
  colors = ["#FF9BF9","#FF6A06", "#e67e22", "#f5b041","#d4ac0d",
            "#f7dc6f","#34495e","#1abc9c","#138d75","#1a5276",
            "#633974"];
  if (relh < 15.0){
    return colors[0];
  }
  else if (relh >= 15.0 && relh < 20.0) {
    return colors[1];
  }
  else if (relh >= 20.0 && relh < 25.0) {
    return colors[2];
  }
  else if (relh >= 25.0 && relh < 30.0) {
    return colors[3];
  }
  else if (relh >= 30.0 && relh < 35.0) {
    return colors[4];
  }
  else if (relh >= 35.0 && relh < 40.0) {
    return colors[5];
  }
  else if (relh >= 40.0 && relh < 70.0) {
    return colors[6];
  }
  else if (relh >= 70.0 && relh < 80.0) {
    return colors[7];
  }
  else if (relh >= 80.0 && relh < 90.0) {
    return colors[8];
  }
  else if (relh >= 90.0 && relh < 95.0) {
    return colors[9];
  }
  else if (relh >= 95.0) {
    return colors[10];
  }
  else{
    console.log("Could not find matching color for relh: "+relh.toString());
    return "#fdfefe";
  }
} // end relhColor function
///////////////////////////////////////////////////////////////////////////////
function epoch2human(epochtime){
  var date = new Date(epochtime);
  return date.toGMTString();
}
///////////////////////////////////////////////////////////////////////////////
function fire_marker_size(acres){
  if (acres >= 5000.0){
    return 10;
  }
  else if (acres >= 1000.0){
    return 8;
  }
  else if (acres >= 300.0){
    return 6;
  }
  else if (acres >= 100.0){
    return 4;
  }
  else{
    return 2;
  }
} // end function
///////////////////////////////////////////////////////////////////////////////
function get_number_of_incidents(url){
  var request = new XMLHttpRequest();
  request.open("GET",url, false);
  request.send(null);
  data = JSON.parse(request.response);
  return data.features.length;
}
///////////////////////////////////////////////////////////////////////////////
function get_nws_rfw_fww_counts(){
  var rfw_count = 0;
  var fww_count = 0;
  var alert_url = "https://api.weather.gov/alerts/active";
  var request = new XMLHttpRequest();
  request.open("GET",alert_url, false);
  request.send(null);
  data = JSON.parse(request.response);
  alerts = data.features;
  alerts.forEach(function(alert){
    if (alert.properties.event == "Red Flag Warning"){
      rfw_count = rfw_count + 1;
    }
    else if (alert.properties.event == "Fire Weather Watch"){
      fww_count = fww_count + 1;
    }
  });
  return [rfw_count, fww_count];
}
///////////////////////////////////////////////////////////////////////////////
function update_header_stats(){
  // Get the number of Red Flag warnings
  var counts = get_nws_rfw_fww_counts();
  document.getElementById("header_rfw").innerHTML = `${counts[0]} Red Flag Warnings`;
  // Get the number of Fire Weather Watches
  document.getElementById("header_fww").innerHTML = `${counts[1]} Fire Weather Watches`;
  // Get the number incidents in the past 24 hours.
  var recent_incidents_url = "https://services3.arcgis.com/T4QMspbfLg3qTGWY/arcgis/rest/services/last24h_WildlandFire_Locations/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson";
  var number_24h_inc = get_number_of_incidents(recent_incidents_url);
  document.getElementById("header_24h").innerHTML = `${number_24h_inc} Incidents Reported in the last 24 Hours`;
  // get the number of large incidents
  var current_large_incidents_url = "https://services3.arcgis.com/T4QMspbfLg3qTGWY/arcgis/rest/services/Current_WildlandFire_Locations/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson";
  var number_current_inc = get_number_of_incidents(current_large_incidents_url);
  document.getElementById("header_inc").innerHTML = `${number_current_inc} Incidents`;
}
///////////////////////////////////////////////////////////////////////////////
function fireCatColor(dn){
  //console.log(dn)
  if (dn == 5){ // elevated
    return "#f5b041";
  } else if (dn == 8) { // critical
    return "#cb4335";
  } else if (dn == 10) { // extremely critical
    return "#9b59b6";
  }
  else {
    return "#FFFFFF";
  }
}
///////////////////////////////////////////////////////////////////////////////
